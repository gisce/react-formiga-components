import{j as h}from"./jsx-runtime-ffb262ed.js";import{r as D}from"./index-76fb7be0.js";import{d as I,u as P,a as b,A as T}from"./useRequiredStyle-3e233289.js";import{T as S}from"./index-df709f45.js";const c={date:{placeholder:"__/__/____",dateDisplayFormat:"DD/MM/YYYY",dateInternalFormat:"YYYY-MM-DD"},time:{placeholder:"__/__/____ __:__:__",dateDisplayFormat:"DD/MM/YYYY HH:mm:ss",dateInternalFormat:"YYYY-MM-DD HH:mm:ss"}},w=r=>new RegExp("^"+r.replace(/DD/g,"\\d{2}").replace(/MM/g,"\\d{2}").replace(/YYYY/g,"\\d{4}").replace(/HH/g,"\\d{2}").replace(/mm/g,"\\d{2}").replace(/ss/g,"\\d{2}").replace(/\//g,"\\/").replace(/\s/g,"\\s")+"$"),F=()=>({day:w("DD"),dayMonth:w("DD/MM"),fullDate:w("DD/MM/YYYY"),withHours:w("DD/MM/YYYY HH"),withMinutes:w("DD/MM/YYYY HH:mm"),withSeconds:w("DD/MM/YYYY HH:mm:ss")}),j=r=>{const{currentValue:e,now:t,mode:d,showTime:Y,onChange:m}=r,o=F();if(!e||e.trim()===""){m(t.format(c[d].dateInternalFormat));return}if(o.day.test(e)){const a=t.date(parseInt(e));m(a.format(c[d].dateInternalFormat))}if(o.dayMonth.test(e)){const[a,n]=e.split("/").map(s=>parseInt(s)),l=t.date(a).month(n-1);m(l.format(c[d].dateInternalFormat))}if(o.fullDate.test(e)){const[a,n,l]=e.split("/").map(u=>parseInt(u)),s=t.date(a).month(n-1).year(l);Y||m(s.format(c.date.dateInternalFormat)),m(s.format(c.time.dateInternalFormat))}if(Y){const[a,n]=e.split(" "),[l,s,u]=a.split("/").map(f=>parseInt(f));let p=t.date(l).month(s-1).year(u);if(o.withHours.test(e)){const[f]=n.split(":").map(M=>parseInt(M));p=p.hour(f),m(p.format(c.time.dateInternalFormat))}if(o.withMinutes.test(e)){const[f,M]=n.split(":").map(_=>parseInt(_));p=p.hour(f).minute(M),m(p.format(c.time.dateInternalFormat))}}},R=(r,e)=>{if(!r)return!0;const t=F();return t.day.test(r)||t.dayMonth.test(r)||t.fullDate.test(r)||e&&(t.fullDate.test(r)||t.withHours.test(r)||t.withMinutes.test(r))},q=(r,e,t)=>{try{return I.tz(r,e,t)}catch(d){return console.error("Parse error:",d),null}},A=({mode:r,showTime:e=!1,onChange:t})=>{const d=D.useRef(!1),Y=D.useCallback(o=>{const a=o.target;if(a.value){const n=I(a.value,c[r].dateDisplayFormat).format(c[r].dateInternalFormat);t==null||t(n)}},[r,t]);return{handleKeyDown:D.useCallback(o=>{if(!o.defaultPrevented){if(o.key==="Enter"){const n=o.target.value;if(!R(n,e))return;o.preventDefault(),j({currentValue:n,now:I(),mode:r,showTime:e,onChange:l=>t==null?void 0:t(l)})}else if(o.key==="Escape"&&!d.current){d.current=!0,setTimeout(()=>{d.current=!1},200),o.preventDefault(),o.stopPropagation();const a=o.currentTarget;if(a.value==="")t==null||t(null);else{const u=I(a.value,c[r].dateDisplayFormat).format(c[r].dateInternalFormat);t==null||t(u)}const n='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',l=Array.from(document.querySelectorAll(n)),s=l.indexOf(a);setTimeout(()=>{s>-1&&s<l.length-1&&l[s+1].focus()},100)}}},[e,r,t]),handleBlur:Y}},H=D.memo(r=>{const{value:e,onChange:t,showTime:d,id:Y,readOnly:m,required:o,timezone:a="Europe/Madrid"}=r,n=P(),l=b(o,!!m),s=d?"time":"date",[u,p]=D.useState(null),f=c[s].dateInternalFormat,M=D.useMemo(()=>{if(e)try{const i=q(e,f,a);if(!i||!i.isValid())throw new Error("Invalid date format");return p(null),i}catch(i){console.error({error:i,value:e,timezone:a,mode:s});const y=i instanceof Error?i.message:"Invalid date";p(y);return}},[e,f,a,s]),_=D.useCallback(i=>{if(!i){t==null||t(null);return}try{const y=i.format(f);p(null),t==null||t(y)}catch(y){console.error({error:y,timezone:a,mode:s});const E=y instanceof Error?y.message:"Invalid date";p(E)}},[t,a,f,s]),{handleKeyDown:v,handleBlur:k}=A({mode:s,showTime:d,onChange:t}),x=D.useMemo(()=>({style:{width:"100%",...l,...u&&{borderColor:"#ff4d4f"}},placeholder:c[s].placeholder,format:c[s].dateDisplayFormat}),[s,l,u]);return h.jsx(S,{title:u,open:!!u,color:"#ff4d4f",placement:"topLeft",children:h.jsx(T,{...x,id:Y,disabled:m,picker:"date",showTime:d,value:M,defaultPickerValue:M,onChange:_,onBlur:i=>k(i),onKeyDown:i=>v(i),showNow:!1,showToday:!1,locale:n,status:u?"error":void 0})})});H.displayName="DateInput";const J=D.memo(H);export{c as D,J as M};
